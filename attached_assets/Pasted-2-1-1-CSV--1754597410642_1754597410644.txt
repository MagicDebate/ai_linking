2.1 Шаг 1: Загрузка и маппинг CSV

Экран: загрузка файла, автоматический предпросмотр первых строк.

Маппинг полей: URL, Текст, meta_title, meta_description, pub_date, lang.

Кнопки: «Назад» (если возвращение из более глубинных шагов), «Далее» (валидирует маппинг).

Ошибки: дубликаты URL, пустые поля, невалидный формат.

2.2 Шаг 2: Базовые настройки (SEO-профиль)

На этом экране пользователь формирует пресеты (сценарии) и вручную настраивает ключевые параметры перелинковки. Все изменения сразу сохраняются в профиле проекта.

2.2.1 Пресеты (сценарии)

Presets — готовые наборы флагов сценариев и их настроек:

«Базовый»

Orphan Fix: ON

Head Consolidation: ON

Cluster Cross-Link: ON

Commercial Routing: ON

Depth Lift: ON (minDepth = 5)

Freshness Push: ON (days = 30, linksPerDonor = 1)

«E‑commerce»

Orphan Fix: ON

Head Consolidation: ON

Cluster Cross-Link: OFF

Commercial Routing: ON

Depth Lift: ON (minDepth = 4)

Freshness Push: OFF

«Свежесть»

Orphan Fix: OFF

Head Consolidation: OFF

Cluster Cross-Link: OFF

Commercial Routing: OFF

Depth Lift: OFF

Freshness Push: ON (days = 30, linksPerDonor = 1)

«Другое»

Все сценарии и параметры оставляются в том виде, как последний раз настроил пользователь; пресет не меняет ничего, но предоставляет возможность сохранить текущую комбинацию для повторного использования.

Пресет задаёт только стартовые значения сценариев и их параметров; после применения можно менять каждое поле вручную.

2.2.2 Основные параметры Основные параметры Основные параметры

Лимиты

maxLinks (slider 1–10): максимум ссылок на страницу.

minGap (slider 50–400 слов): минимальное расстояние между ссылками.

exactAnchorPercent (slider 0–50%): доля точных анкорных фраз.

Стоп‑лист анкоров (textarea): список фраз, которые никогда не используются.

Приоритетные (money) URL (chip‑input): список URL для Commercial Routing.

2.2.3 Сценарии (пасс-переключатели)

Для каждого сценария есть флаг ON/OFF и, при необходимости, доп. настройки:

Orphan Fix (ON/OFF)

Head Consolidation (ON/OFF)

Cluster Cross-Link (ON/OFF)

Commercial Routing (ON/OFF)

Depth Lift

ON/OFF

minDepth (input 3–8 кликов)

Freshness Push

ON/OFF

daysFresh (input 7–60 дней)

linksPerDonor (slider 0–3)

2.2.4 Каннибализация

Порог похожести (Low/Medium/High → 0.75/0.80/0.85)

Действие (Radio: Block / Flag only)

Правило выбора каноника (Radio: По полноте текста / По URL-структуре / Manual)

Ручное переопределение (при Manual): загрузка CSV или переход в Draft Review для выбора.

2.2.5 Политики ссылок и HTML‑атрибуты

Old Links Policy: Enrich / Regenerate / Audit only

Remove Duplicates: чекбокс — запрет повторных ссылок на один URL

Broken-link Policy: Delete / Replace / Ignore

HTML Attributes

className (text-input)

rel (checkboxes noopener/noreferrer/nofollow)

targetBlank (switch)

classMode (append/replace)

Навигация

Кнопки: «Назад» (возврат к маппингу), «Сохранить и запустить импорт»

Сохранённые параметры отображаются кратко в шапке проекта и влияют на все следующие прогоны.

2.3 Шаг 3: Прогресс импорта / обработки контента Шаг 3: Прогресс импорта / обработки контента

Этапы: CSV-парсинг → HTML-очистка → Разбиение на блоки → Векторизация → Построение графа → Завершено.

Live-progress: название этапа, процент, краткая статистика после каждого шага (pages, blocks, orphans, avgDepth).

Консоль-логи: последние 100 строк с возможностью «Скачать полный лог».

Кнопка «Сгенерировать ссылки» активируется по завершении.

Возможность прервать/отменить импорт.

2.4 Шаг 4: Настройка области генерации (Scope)

Модалка перед запуском: фильтры по URL-паттерну, дате, глубине, роли, случайная выборка %, ручной список.

«Назад» — возвращает на шаг настроек.

«Старт» — отправляет в очередь генерации.

2.5 Шаг 5: Прогресс генерации ссылок

Этапы пассов: Orphan Fix → Head Consolidation → Depth Lift → Freshness Push → Cluster Cross-Link → Commercial Routing → Политика 404.

Live-progress: текущий пасс, процент, total+rejected.

Список ошибок/причин отклонения (limit, stop-anchor, cannibal_block).

Дебаг: кнопка «Посмотреть кандидатов по пассу».

2.6 Шаг 6: Draft Review

Страница /project/:id/draft/:runId.

UI: фильтры-чипы по типам ссылок и причинам; таблица источников/целей/анкор-строк; статус ✓/✖; diff viewer.

Вкладка «Конкуренты» для ручного выбора каноников.

Боковая панель: статистика before/after (orphans, depth, anchor profile).

Кнопка «Применить / Экспорт»: CSV, ZIP-patch, Git PR, Webhook.

2.7 Шаг 7: Публикация и дашборд

После publish: run.status = published; отчёты в дашборде.

Дашборд проекта: история ран-ов, ключевые метрики до/после каждого run (orphans, depth, links added, anchor profile).

Ссылка на скачивание патчей и открытие PR.

3. Основная логика и правила

Очистка HTML: убрать boilerplate, оставить только контент.

Разбиение на блоки: h2/h3/p/li с порядкой.

Векторизация: batch-эмбеддинги блоков для ANN-поиска.

Граф ссылок: extract existing links, compute in/out-degree и clickDepth.

Генерация кандидатов:

Для каждого абзаца (блока-донора) ищем через ANN-поиск топK целевых блоков по смыслу.

Получаем список подходящих блоков из других страниц, ранжируем по косинусной близости.

Проходим по отсортированным блокам и для каждого:

Проверяем: нет ли уже ссылки на эту цель, не нарушается ли maxLinks, minGap, exactAnchorPercent, не попадает ли анкор в стоп-лист, не блокирует ли каннибализация.

Выбор анкоров:

В исходном блоке ищем ключевую фразу, наиболее отражающую тему целевой страницы.

Если точная фраза есть — используем ее.

Если нет — передаем весь текст блока модели OpenAI для перефразирования и извлечения анкора не длиннее N слов.

Ограничиваем длину анкоров и проверяем по regex, чтобы не было лишних символов.

Если после фильтров и выбора анкоров все условия соблюдены — сохраняем кандидата ссылки и увеличиваем счётчик на странице.

Останавливаем подбор для текущей страницы, когда достигнут maxLinks.

Пост-обработка: 404-policy + HTML-атрибуты:** 404-policy + HTML-атрибуты.

Ручное ревью и публикация.